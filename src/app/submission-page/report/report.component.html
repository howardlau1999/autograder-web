<h2>测试报告</h2>
<div *ngIf="report$ | async as report; else errorMsg" class="report-container">
  <p *ngIf="report.getInternalError()">发生内部错误（错误码：{{ report.getInternalError() }}）</p>
  <mat-accordion class="testcase-accordion" multi>
    <mat-expansion-panel *ngIf="report.getLeaderboardList()?.length">
      <mat-expansion-panel-header> 排行榜分数</mat-expansion-panel-header>
      <mat-list>
        <mat-list-item *ngFor="let item of report.getLeaderboardList()">
          {{ item.getName() }}
          {{
            item.getValue()?.hasNumberValue()
              ? item.getValue()?.getNumberValue()
              : item.getValue()?.getStringValue()
          }} &nbsp;
          {{ item.getSuffix() }}
        </mat-list-item>
      </mat-list>
      <mat-action-row class="attachment">
        <button
          (click)="activateSubmission()"
          matTooltip="使用该分数参与排行榜排行"
          color="accent"
          mat-flat-button
        >
          提交排行
        </button>
      </mat-action-row>
    </mat-expansion-panel>
    <mat-expansion-panel *ngIf="report.getOutput()" class="testcase-panel">
      <mat-expansion-panel-header>
        <mat-panel-title> 测试输出</mat-panel-title>
      </mat-expansion-panel-header>
      <code>
        <pre class="testcase-output">{{ report.getOutput() }}</pre>
      </code>
    </mat-expansion-panel>
    <mat-expansion-panel
      #testcase
      *ngFor="let testcase of report.getTestsList(); index as i"
      class="testcase-panel"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <span [class]="testcase.getScore() === testcase.getMaxScore() ? 'green-font' : 'red-font'"
            >{{ testcase.getName() }} ({{ testcase.getScore() }}/{{ testcase.getMaxScore() }})
          </span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <code>
        <pre class="testcase-output">{{ testcase.getOutput() }}</pre>
      </code>
      <mat-action-row *ngIf="testcase.getOutputPath()" class="attachment">
        <button matTooltip="该测试含有输出附件" mat-flat-button>
          <mat-icon>file_present</mat-icon>
          {{ testcase.getOutputPath() }}
          <mat-icon>download</mat-icon>
        </button>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>
  <mat-nav-list class="testcase-list">
    <a
      (click)="scrollTo(i)"
      *ngFor="let testcase of report.getTestsList(); index as i"
      mat-list-item
    >
      <span [class]="testcase.getScore() === testcase.getMaxScore() ? 'green-font' : 'red-font'"
        >{{ testcase.getName() }} ({{ testcase.getScore() }}/{{ testcase.getMaxScore() }})
      </span>
    </a>
  </mat-nav-list>
</div>
<ng-template #errorMsg>
  <div [ngSwitch]="error" class="report-container">
    <div style="width: 100%">
      <mat-card *ngSwitchCase="'RUNNING'">
        <mat-card-title>测试运行中…</mat-card-title>
        <p></p>
        <mat-progress-bar mode="buffer"></mat-progress-bar>
      </mat-card>
      <mat-card *ngSwitchDefault>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </mat-card>
    </div>
  </div>
</ng-template>
