<h2>测试报告</h2>
<div *ngIf="report$ | async as report; else errorMsg" class="report-container">
  <p *ngIf="report.getInternalError()">
    发生内部错误（错误码：{{report.getInternalError()}}）
  </p>
  <mat-accordion class="testcase-accordion" multi>
    <mat-expansion-panel *ngIf="report.getOutput()" class="testcase-panel">
      <mat-expansion-panel-header>
        <mat-panel-title> 测试输出</mat-panel-title>
      </mat-expansion-panel-header>
      <code>
        <pre class="testcase-output">{{ report.getOutput() }}</pre>
      </code>
    </mat-expansion-panel>
    <mat-expansion-panel
      #testcase
      *ngFor="let testcase of report.getTestsList(); index as i"
      class="testcase-panel"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <span [class]="testcase.getScore() === testcase.getMaxScore() ? 'green-font' : 'red-font'"
          >{{ testcase.getName() }} ({{ testcase.getScore() }}/{{ testcase.getMaxScore() }})
          </span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <code>
        <pre class="testcase-output">{{ testcase.getOutput() }}</pre>
      </code>
    </mat-expansion-panel>
  </mat-accordion>
  <mat-nav-list class="testcase-list">
    <a
      (click)="scrollTo(i)"
      *ngFor="let testcase of report.getTestsList(); index as i"
      mat-list-item
    >
      <span [class]="testcase.getScore() === testcase.getMaxScore() ? 'green-font' : 'red-font'"
      >{{ testcase.getName() }} ({{ testcase.getScore() }}/{{ testcase.getMaxScore() }})
      </span>
    </a>
  </mat-nav-list>
</div>
<ng-template #errorMsg>
  <div [ngSwitch]="error" class="report-container">
    <div style="width: 100%">
      <mat-card *ngSwitchCase="'RUNNING'">
        <mat-card-title>测试运行中…</mat-card-title>
        <p></p>
        <mat-progress-bar mode="buffer"></mat-progress-bar>
      </mat-card>
      <mat-card *ngSwitchDefault>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </mat-card>
    </div>
  </div>
</ng-template>
